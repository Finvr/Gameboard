<div class="profile">
  <div class="container">
    <div class="row">

    <!-- left side -->
    <div class="col m5">
      <center class="profile-box">
        <div class="img-wrapper">
          <img  class="responsive-img circle profilePic" src="{{ myProfile.picture }}">
        </div>
        <div class="staticProfile">Rating: {{ myProfile.reviews.rating ? myProfile.reviews.rating : "N/A"}}<span class="reviewCounts"> {{"(" + (myProfile.reviews.reviewcounts ? myProfile.reviews.reviewcounts : 0) + ")" }}</span></div>
        <div class="staticProfile">Reliability: {{ myProfile.reviews.reliability ? (myProfile.reviews.reliability * 100 + "%") : "N/A"}}</div>
      </center>
    </div>

    <!-- Right side -->
    <div class="col m7">
      <h4 class="collection-item avater profile-field username">
        {{ myProfile.username }}
      </h4>   
      <ul class="collection profile-field">
        <li class="profile-field location">
          <div ng-click="showInput('.location')"><span class="read">{{ myProfile.location ? myProfile.location : "N/A"}}</span> 
            <span class="write"><input type="text" ng-model="myProfile.location"></span> 
          </div>
        </li>
        <li class="profile-field about-me">
          <span class="title"><strong>About Me:</strong> </span>
          <div ng-click="showInput('.about-me')"><span class="read">{{ myProfile.about_me ? myProfile.about_me : "N/A" }}</span> 
            <span class="write"><input type="text" ng-model="myProfile.about_me" ng-model-options="{ updateOn: 'blur' }"></span> 
          </div>
        </li>
        <li class="profile-field games-i-like">
          <span class="title"><strong>Games I Like:</strong> </span>
          <div ng-click="showInput('.games-i-like')"><span class="read">{{ myProfile.games_list ? myProfile.games_list : "N/A" }}</span> 
            <span class="write"><input type="text" ng-model="myProfile.games_list"></span> 
          </div>
        </li>
      </ul>
      <a class="fbIcon" target="_blank" href="{{myProfile.link}}"><img align="middle" src="assets/facebook.png"></a>  
      <a ng-if="update" ng-click="updateProfile(myProfile)" class="center btn" ng-show="!myProfile.viewId">Save Changes</a>
    </div>
    </div>

    <!-- Recent Game List -->
    <div class="recent_game_list" ng-if="!myProfile.viewId">
       <ul class="collection" watch>
        <li class="collection-header collection-item"><h5>My Recent Games</h5></li>
        <li class="collection collection-item red-text center" ng-if="recentGames.length === 0">You have played no games.</li>
        <li class="collection-item" ng-repeat="game in recentGames | orderBy: '-game_datetime'" watch>
          <div class='row game_list'>
            <div class="left col s4" id="game_title" style="display:inline">{{game.game ? game.game : "No Name"}}</div>
            <div class="col s5"> <span ng-if="game.distance">{{+ game.distance + " m | "}}</span> {{game.game_datetime | date:"EEE, MMM-d-y '@' h:mma"}}, Players: {{ game.accepted_players }}/{{game.player_count}}
            </div>

            <div class="right col s3" ng-if="loggedIn && !game.reviewed" ng-click="openRateModal(game)">
              <a class='btn grey darken-3' href='#openRateModal' modal>Rate</a>
            </div>
            <div class="right col s3" ng-if="loggedIn && game.reviewed" ng-click="openRateModal(game)">
              <a class='btn grey darken-3' href='#openRateModal' modal>View</a>
            </div>
          </div>        
        </li>
      </ul> 
    </div>
  </div>

  <!-- detail Modal for rating each game -->
  <div id="openRateModal" class="modal">
    <div class="modal-header grey">
      <div ng-click="close('#openRateModal')"><i class="material-icons right close">close</i></div>
      <span class="white-text"><h4>{{currentRateGame.game ? currentRateGame.game : "No Name"}}</h4></span>
    </div>
    <div class="modal-content">
      <div>
        <span class="grey-text">Host:</span> 
        <a href="#/profile/{{currentRateGame.host_id}}" target="_blank"><img class="hostPic" ng-src="{{currentRateGame.picture || currentRateGame.host_pic}}">{{currentRateGame.host_name || currentRateGame.username}}</a>
      </div>
      <div>
        <span class="grey-text">Location:</span> {{currentRateGame.game_location}}
      </div>
      <div class="row">
        <table ng-if="currentRateGame.playerPics.length > 0">
          <thead>
            <tr>
              <th class="players">Player</th>
              <th>Skip</th>
              <th>Showed up</th>
              <th>Rating</th>
            </tr>
          </thead>

          <tbody>
            <tr ng-repeat="player in currentRateGame.playerPics">
              <td class="players">
                <a href="#/profile/{{player.user_id}}" target="_blank" ><img class="hostPic" ng-src="{{player.picture}}">{{player.username}}</a>
              </td>
              <td ng-if="!currentRateGame.reviewed">
                <div class="switch" >
                  <label>
                    <input type="checkbox" ng-model="player.skip" value="false">
                    <span class="lever"></span>
                  </label>
                </div>
                <span class="reviewResults" watch>{{player.skip ? "Don't Rate" : "Rate"}}</span>
              </td>
              <td ng-if="!player.skip">               
                <div class="switch" ng-if="!player.skip">
                  <label>
                    <input type="checkbox" ng-model="player.showed_up">
                    <span class="lever"></span>
                  </label>
                </div>
                <span class="reviewResults"  watch>{{player.showed_up ? "Yes" : "No"}}</span>
              </td>
              <td ng-if="!player.skip && player.showed_up">
                <input type="range" ng-model="player.rating" min="0" max="5" />
                <span class="reviewResults"  watch>{{player.rating}}</span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="modal-footer" ng-if="!currentRateGame.reviewed">
        <div class = "col s4 right" ng-click="sendReviews(currentRateGame.playerPics)">
          <a class = "btn btn-med waves-effect center waves-light grey darken-3" ng-click="close('#openRateModal')">
            Complete Rating
          </a>
        </div>
      </div>
    </div>
  </div>
  <!-- modal complete -->

</div>